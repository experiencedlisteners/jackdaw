# Introduction

Jackdaw is a model-definition framework that supports Bayesian networks and dynamic Bayesian networks (the latter more fully than the former at the moment).

Jackdaw can generate joint and marginal distributions conditioned on observations, enabling for exact Bayesian inference on simple generative models.

Furthermore, it allows implementing model estimation procedures enabling the estimation of generative models from datasets.

# Core concepts



## Bayesian network

A Bayesian network is a set of random variables organised in a directed a-cyclic graph.

## Dynamic Bayesian network

A dynamic Bayesian network is a Bayesian network that generates sequences of observations. Distributions and congruency functions associated with random variables can be conditioned on outcomes in the previous observation.

## Definition macros

DEFDISTRIBUTION defines subclasses of PROBABILITY-DISTRIBUTION.

A jackdaw model is a subclass of BAYESIAN-NETWORK (a subclass of PROBABILITY-DISTRIBUTION) or DYNAMIC-BAYESIAN-NETWORK (a subclass of BAYESIAN-NETWORK).
These models are defined by the DEFMODEL macro.

A jackdaw model definition creates defines a class with the name of the model with a set of parameters, a set of random variables (instances of RANDOM-VARIABLE), associated probability distributions, and associated *congruency constraints*, functions that generate the set of possible outcomes of a random variable, optionally conditioned on a subset of it's parent-variables.

DEFESTIMATOR defines estimators for any probability distribution.

## Domains

In this documentation, the *domain* of a probability distribution refers its possible outcomes.

For BAYESIAN-NETWORK and DYNAMIC-BAYESIAN-NETWORK, the method GENERATE will generate the domain of the generative model. In the case of DYNAMIC-BAYESIAN-NETWORK, this domain is conditioned on an outcome in a previous moment.

There is no explicit API for keeping track of the domain of a probability distribution.

## Probability

The methods PROBABILITY, CONDITIONAL-PROBABILITY and CONDITIONAL-PROBABILITIES can be used on PROBABILITY-DISTRIBUTION and all of its subclasses.

## Parameters

Parameters are defined as class-slots by DEFMODEL.

## Datasets and observations

Throughout this documentation, a *dataset* refers to a set of of observations in no particular order.

An observation is in principle a state that can be generated by a generative model, although jackdaw allows for looser coupling between observations and generated states via *observation functions*.

In the case of a dynamic Bayesian network, an observation is always represented by a sequence. The elements of this sequence are called *moments*, so an observation of a dynamic Bayesian network is a sequence of moments. Indeed, a sequence of arbitrary length represents a state that can be generated by a dynamic Bayesian network.

In practice, datasets and sequences are often lists represented by lists. However, jackdaw makes no assumptions about the order of observations in a dataset.

## Observations

## States

A state is whatever the variables of a model jointly generate. In jackdaw, states are represented by hash-tables.

## Estimation

Model estimation currently supported for dynamic Bayesian networks, but not for normal Bayesian networks.

The macro DEFESTIMATOR allows the definition of estimators for any probability distribution.

A model is estimated from a dataset of observations. As such, a dynamic Bayesian network is estimated from a dataset of sequences of moments (see [Datasets and observations](concepts#datasets-and-observations).)

# Configuration

## CSV output

Jackdaw supports writing the congruent states of a model (in effect, the joint distribution of the model's variables in which the observed one's are clamped to their observed value) as quasi-CSV output.*

This behaviour is controlled by the OUTPUT and OUTPUT-VAR slots of jackdaw models.

Consider for example the example model given in jackdaw-tutorial for tonality. Assuming we're in a REPL session where an instance has been created and estimated in the way suggested at the bottom of the example file, we can turn enable CSV output to the REPL as follows:

```
> (setf (jd:out *key*) t)
T
```

If we now call GENERATE on the model and a sequence of observations, the a comma-separated list with variable-values and other information like a positional identifier of the moment and (if applicable) sequence, as well as the probability of the state.

```
> (jd:generate *key* '(7 5 4 0 2 7 0))
sequence,moment,tonic,tonic-name,scale,scale-degree,pitch,pitch-name,probability
NIL,0,0,C,MAJOR,(7),7,G0,T,0.018016152
NIL,0,0,C,MINOR,(7),7,G0,T,3.6009075e-4
...
```

However, in the case of this model, a number of variables encode redundant information. For example, TONIC and TONIC-NAME have a one-to-one relation. The only difference is that TONIC-NAME tends to be more readable for humans. To print only the subset of variables necessary for analysis, we can use OUTPUT-VARS.

```
> (setf (jd:output-vars *key*) '(tonic scale pitch))
```

ensures that only the values of TONIC, SCALE, and PITCH are written (in addition to "sequence", "observation", and "probability").

This method can equally be used to redirect the jackdaw output to a file or network stream.

```
(with-output-to-string (*error-output*)
	   (jd:generate *key* '(7 5 4 0 2 7 0)))
```

* Quasi-CSV because no special care is take to escape variable values. Values are printed as a comma-separated list. If any of the variables contains commas or quotes in its values this will cause problems for programs attempting to read the output as CSV data.

# Future features

* Composable models: insert (dynamic) Bayesian networks in (dynamic) Bayesian networks
* Fix conceptual mismatch that distributions are estimated from sequences of observations
* Use a sub-macro for defining variables of a Bayesian network, package as class instances, allowing them to be re-used across models (or defined separately upfront)
* Re-structure: there is nothing special about the distributions package
  * Use defestimator
* Optimize estimate and cumulative variables (generates lists of increasing lentgh)